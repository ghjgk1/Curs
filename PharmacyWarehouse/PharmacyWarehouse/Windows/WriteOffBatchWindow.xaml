<Window x:Class="PharmacyWarehouse.Windows.WriteOffBatchWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:PharmacyWarehouse.Windows"
        mc:Ignorable="d"
        Title="Списание партии"
        Height="650" Width="700"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ЗАГОЛОВОК -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock Text="Списание товара" Style="{StaticResource H2}"/>
            <TextBlock Text="Заполните информацию о списании" 
                       Style="{StaticResource Caption}"/>
        </StackPanel>

        <!-- ОСНОВНОЙ КОНТЕНТ -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- ИНФОРМАЦИЯ О ПАРТИИ -->
                <Border Style="{StaticResource Card}" Margin="0,0,0,12">
                    <StackPanel>
                        <TextBlock Text="Информация о партии" Style="{StaticResource H3}" Margin="0,0,0,12"/>

                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Номер партии -->
                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Номер партии:" 
                                       Style="{StaticResource BodyText}" Margin="0,0,8,8"/>
                            <TextBlock Grid.Row="0" Grid.Column="1" x:Name="txtBatchNumberDisplay"
                                       Style="{StaticResource BodyText}" FontWeight="SemiBold" Margin="0,0,0,8"/>

                            <!-- Товар -->
                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Товар:" 
                                       Style="{StaticResource BodyText}" Margin="0,0,8,8"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" x:Name="txtProductName"
                                       Style="{StaticResource BodyText}" FontWeight="SemiBold" Margin="0,0,0,8"/>

                            <!-- Поставщик -->
                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Поставщик:" 
                                       Style="{StaticResource BodyText}" Margin="0,0,8,8"/>
                            <TextBlock Grid.Row="2" Grid.Column="1" x:Name="txtSupplierName"
                                       Style="{StaticResource BodyText}" Margin="0,0,0,8"/>

                            <!-- Срок годности -->
                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Срок годности:" 
                                       Style="{StaticResource BodyText}" Margin="0,0,8,8"/>
                            <StackPanel Grid.Row="3" Grid.Column="1" Orientation="Horizontal">
                                <TextBlock x:Name="txtExpirationDate" 
                                           Style="{StaticResource BodyText}" Margin="0,0,0,8"/>
                                <TextBlock x:Name="txtExpirationStatus"
                                           Style="{StaticResource Caption}"
                                           Margin="8,0,0,0"
                                           VerticalAlignment="Center"/>
                            </StackPanel>

                            <!-- Доступное количество -->
                            <TextBlock Grid.Row="4" Grid.Column="0" Text="Доступно:" 
                                       Style="{StaticResource BodyText}" Margin="0,0,8,0"/>
                            <StackPanel Grid.Row="4" Grid.Column="1" Orientation="Horizontal">
                                <TextBlock x:Name="txtAvailableQuantity" 
                                           Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                <TextBlock Text=" шт." Style="{StaticResource BodyText}" Margin="4,0,0,0"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- ДАННЫЕ ДЛЯ СПИСАНИЯ -->
                <Border Style="{StaticResource Card}" Margin="0,0,0,12">
                    <StackPanel>
                        <TextBlock Text="Данные для списания" Style="{StaticResource H3}" Margin="0,0,0,12"/>

                        <!-- Номер документа -->
                        <StackPanel Margin="0,0,0,12">
                            <TextBlock Text="Номер документа*" Style="{StaticResource BodyText}" Margin="0,0,0,4"/>
                            <TextBox x:Name="txtDocumentNumber" 
                                     GotFocus="TxtDocumentNumber_GotFocus"
                                     LostFocus="TxtDocumentNumber_LostFocus"/>
                        </StackPanel>

                        <!-- Причина списания -->
                        <StackPanel Margin="0,0,0,12">
                            <TextBlock Text="Причина списания*" Style="{StaticResource BodyText}" Margin="0,0,0,4"/>
                            <ComboBox x:Name="cmbWriteOffReason">
                                <ComboBoxItem Content="Просрочка"/>
                                <ComboBoxItem Content="Повреждение"/>
                                <ComboBoxItem Content="Кража"/>
                                <ComboBoxItem Content="Брак"/>
                                <ComboBoxItem Content="Прочее"/>
                            </ComboBox>
                        </StackPanel>

                        <!-- Количество для списания -->
                        <StackPanel Margin="0,0,0,12">
                            <TextBlock Text="Количество для списания*" Style="{StaticResource BodyText}" Margin="0,0,0,4"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBox x:Name="txtQuantity" 
                                         Text="0"
                                         PreviewTextInput="NumberValidationTextBox"
                                         TextChanged="TxtQuantity_TextChanged"/>

                                <Button x:Name="btnMaxQuantity" Grid.Column="1" 
                                        Content="Макс" 
                                        Style="{StaticResource OutlineButton}" 
                                        Margin="8,0,0,0"
                                        Width="60"
                                        Click="BtnMaxQuantity_Click"/>
                            </Grid>
                        </StackPanel>

                        <!-- Комментарий -->
                        <StackPanel>
                            <TextBlock Text="Комментарий" Style="{StaticResource BodyText}" Margin="0,0,0,4"/>
                            <TextBox x:Name="txtComment" 
                                     Height="60"
                                     TextWrapping="Wrap"
                                     AcceptsReturn="True"
                                     VerticalScrollBarVisibility="Auto"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- РАСЧЕТЫ -->
                <Border Style="{StaticResource Card}" Margin="0,0,0,12">
                    <StackPanel>
                        <TextBlock Text="Финансовые расчеты" Style="{StaticResource H3}" Margin="0,0,0,12"/>

                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Цена закупки (единица) -->
                            <TextBlock Grid.Row="0" Grid.Column="0" 
                                       Text="Цена закупки:" 
                                       Style="{StaticResource BodyText}"/>
                            <TextBlock Grid.Row="0" Grid.Column="1" 
                                       x:Name="txtPurchasePrice" 
                                       Style="{StaticResource BodyText}" 
                                       HorizontalAlignment="Right"/>

                            <!-- Сумма списания -->
                            <TextBlock Grid.Row="1" Grid.Column="0" 
                                       Text="Сумма списания:" 
                                       Style="{StaticResource BodyText}" 
                                       Margin="0,8,0,0"
                                       FontWeight="SemiBold"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" 
                                       x:Name="txtWriteOffAmount" 
                                       Style="{StaticResource BodyText}" 
                                       FontWeight="Bold" 
                                       FontSize="16"
                                       Foreground="{StaticResource AccentRedBrush}"
                                       HorizontalAlignment="Right" 
                                       Margin="0,8,0,0"/>

                            <!-- Остаток после списания -->
                            <TextBlock Grid.Row="2" Grid.Column="0" 
                                       Text="Останется на складе:" 
                                       Style="{StaticResource BodyText}"/>
                            <TextBlock Grid.Row="2" Grid.Column="1" 
                                       x:Name="txtRemainingAfterWriteOff" 
                                       Style="{StaticResource BodyText}" 
                                       HorizontalAlignment="Right"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- ПРЕДУПРЕЖДЕНИЯ -->
                <Border x:Name="warningBorder" 
                        Style="{StaticResource WarningBox}" 
                        Visibility="Collapsed"
                        Margin="0,0,0,12">
                    <StackPanel>
                        <TextBlock Text="⚠️ ВНИМАНИЕ!" 
                                   Style="{StaticResource BodyText}" 
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource AccentOrangeBrush}"
                                   Margin="0,0,0,4"/>
                        <TextBlock x:Name="txtWarningMessage" 
                                   Style="{StaticResource BodyText}"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <!-- ОШИБКИ -->
                <Border x:Name="errorBorder" 
                        Style="{StaticResource ErrorBox}" 
                        Visibility="Collapsed"
                        Margin="0,0,0,12">
                    <StackPanel>
                        <TextBlock x:Name="txtErrorMessage" 
                                   Style="{StaticResource BodyText}"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <!-- ИТОГО -->
                <Border Style="{StaticResource InfoBox}">
                    <StackPanel>
                        <TextBlock Text="Итог списания" 
                                   Style="{StaticResource BodyText}"
                                   FontWeight="SemiBold"/>
                        <TextBlock x:Name="txtTotalWriteOff" 
                                   Text="0.00 руб." 
                                   FontSize="20" 
                                   FontWeight="Bold"
                                   Foreground="{StaticResource AccentRedBrush}"
                                   Margin="0,4,0,0"/>
                        <TextBlock Text="Убыток компании" 
                                   Style="{StaticResource Caption}"
                                   Foreground="{StaticResource AccentRedBrush}"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- КНОПКИ -->
        <Border Grid.Row="2" 
                BorderBrush="{StaticResource BorderLightBrush}" 
                BorderThickness="0,1,0,0"
                Padding="0,16,0,0"
                Margin="0,16,0,0">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="Отмена" 
                        Style="{StaticResource OutlineButton}" 
                        Width="120" 
                        Click="Cancel_Click"/>
                <Button Content="Подтвердить списание" 
                        x:Name="btnWriteOff"
                        Style="{StaticResource DangerButton}" 
                        Width="180" 
                        Margin="12,0,0,0" 
                        Click="WriteOff_Click"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>